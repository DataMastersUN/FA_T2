{% extends "layouts/base.html" %}

{% block title %} Predicción {% endblock %} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <!-- ============================================================== -->
    <!-- Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <div class="page-breadcrumb">
        <div class="row align-items-center">
            <div class="col-md-8 col-8 align-self-center">
                <h3 class="page-title mb-0 p-0">Predicción de Accidentalidad</h3>
                <div class="d-flex align-items-center">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="#">Inicio</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Predicción</li>
                        </ol>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <!-- ============================================================== -->
    <!-- End Bread crumb and right sidebar toggle -->
    <!-- ============================================================== -->
    <!-- ============================================================== -->
    <!-- Container fluid  -->
    <!-- ============================================================== -->
    <div class="container-fluid">
        <!-- ============================================================== -->
        <!-- Start Page Content -->
        <!-- ============================================================== -->
        <div class="row">
            <!-- column -->
            <div class="col-sm-12">
                <div class="filters">
                    <form method="get">
                        <div class="filters-row">
                            <div class="col-md-2">
                                <label for="prediction_select">Predecir por(Obligatorio):</label>
                                <select required name="prediction_by" class="form-control" id="prediction_select">
                                    <option value="" selected="true" disabled="disabled">Selecciona</option>
                                    <option value="day" {% if request.args.get('prediction_by')=="day" %}selected{% endif %}>Día</option>
                                    <option value="week" {% if request.args.get('prediction_by')=="week" %}selected{% endif %}>Semana</option>
                                    <option value="month" {% if request.args.get('prediction_by')=="month" %}selected{% endif %}>Mes</option>
                                </select>
                            </div>
                            <div class="col-md-2" id="year_month_container" style="display: none">
                                <label for="day_input">Selecciona un Día(Obligatorio):</label>
                                <input value="{{ request.args.get('selected_day', '') }}" class="form-control" type="date" id="day_input" name="selected_day" min="2019-03-01" max="2023-12-31">
                            </div>
                            <div class="col-md-2" id="week_container" style="display: none">
                                <label for="week_input">Selecciona una Semana:(Obligatorio)</label>
                                <input value="{{ request.args.get('selected_week', '') }}" class="form-control" type="week" id="week_input" name="selected_week" min="2019-W09" max="2023-W52">
                            </div>
                            <div class="col-md-2" id="month_container" style="display: none">
                                <label for="month_input">Selecciona un Mes(Obligatorio):</label>
                                <input value="{{ request.args.get('selected_month', '') }}" class="form-control" type="month" id="month_input" name="selected_month" min="2019-03" max="2023-12">
                            </div>                            
                            <div class="col-md-2">
                                <label for="accident_type_select">Tipo de Accidente (Obligatorio):</label>
                                <select required name="accident_type" class="form-control" id="accident_type_select">
                                    <option value="choque" {% if request.args.get('accident_type')=="choque" %}selected{% endif %}>Choque</option>
                                    <option value="atropello" {% if request.args.get('accident_type')=="atropello" %}selected{% endif %}>Atropello</option>
                                    <option value="caida" {% if request.args.get('accident_type')=="caida" %}selected{% endif %}>Caida Ocupante</option>
                                    <option value="volcamiento" {% if request.args.get('accident_type')=="volcamiento" %}selected{% endif %}>Volcamiento</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <div class="row">
                                    <div class="col-md-2">
                                        <input type="submit" class="btn btn-info" value="Predecir">
                                    </div>
                                    {% if request.args.get('prediction_by') %}
                                    <div class="col-md-2">
                                        <a class="btn btn-danger" href="{{ url_for('prediction') }}">Limpiar</a>
                                    </div>                            
                                    {% endif %}
                                </div>                                                                 
                            </div>                                                       
                        </div>
                    </form>                               
                </div>
                {% if result != 0 %}
                {% if accident_type %}
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">
                            <h1>Se predicen <b>{{ result }}</b> Accidentes tipo {{ accident_type }} para la fecha: {{ date }}</h1>
                        </div>
                    </div>
                </div>
                {% endif %}
                {% endif %}
            </div>
        </div>
        <!-- ============================================================== -->
        <!-- End PAge Content -->
        <!-- ============================================================== -->
    </div>
    <!-- ============================================================== -->
    <!-- End Container fluid  -->
    <!-- ============================================================== -->

{% endblock content %}

{% block javascripts %}
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const predictionSelected = urlParams.get('prediction_by');

    const predictionSelect = document.getElementById('prediction_select');
    const yearMonthContainer = document.getElementById('year_month_container');
    const weekContainer = document.getElementById('week_container');
    const monthContainer = document.getElementById('month_container');
    const yearMonthInput = document.getElementById('day_input');
    const weekInput = document.getElementById('week_input');
    const monthInput = document.getElementById('month_input');
    checkFields()

    predictionSelect.addEventListener('change', function() {
        checkFields()
    });

    function checkFields() {
        yearMonthContainer.style.display = 'none';
        weekContainer.style.display = 'none';
        monthContainer.style.display = 'none';

       yearMonthInput.removeAttribute('required');
        weekInput.removeAttribute('required');
        monthInput.removeAttribute('required');
        
        const selectedValue = predictionSelect.value;
        
        if (selectedValue === 'day') {
            yearMonthContainer.style.display = 'block';
            yearMonthInput.setAttribute('required', 'required');
        } else if (selectedValue === 'week') {
            weekContainer.style.display = 'block';
            weekInput.setAttribute('required', 'required');
        } else if (selectedValue === 'month') {
            monthContainer.style.display = 'block';
            monthInput.setAttribute('required', 'required');
        }
    }
</script> 
{% endblock javascripts %}
